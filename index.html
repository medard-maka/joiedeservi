<!DOCTYPE html>
<html>

<head>
    <title>Affichage de l'ID RFID</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="container">
        <table id="records-table">
            <thead>
                <tr>
                    <th></th>
                    <th>Field1</th>
                    <th>Field2</th>
                    <th>Field3</th>
                    <th>Field4</th>
                    <th>Field5</th>
                    <th>Field6</th>
                </tr>
            </thead>
            <tbody id="records-body"></tbody>
        </table>
    </div>

    <script>
        // Paramètres ThingSpeak
        var channelId = 2572384;
        var apiKey = "BGMFDPDQNOKGCHYQ";
        var fieldIds = [1, 2, 3, 4, 5, 6]; // Champs où sont stockés les ID

        // Variable pour stocker les enregistrements
        var records = [
            [], // Pour stocker les valeurs du champ 1
            [], // Pour stocker les valeurs du champ 2
            [], // Pour stocker les valeurs du champ 3
            [], // Pour stocker les valeurs du champ 4
            [], // Pour stocker les valeurs du champ 5
            [], // Pour stocker les valeurs du champ 6
        ];

        // Fonction pour récupérer et afficher les ID
        function updateRecords() {
            var promises = [];
            for (var i = 0; i < fieldIds.length; i++) {
                var fieldId = fieldIds[i];
                var promise = $.getJSON("https://api.thingspeak.com/channels/" + channelId + "/fields/" + fieldId + "/last.json?api_key=" + apiKey, function(data) {
                    records[fieldId - 1].push(data.field1); // Stockage dans le tableau correspondant
                    updateRecordsTable();
                }).fail(function() {
                    console.error("Erreur lors de la récupération des données pour le champ", fieldId);
                });
                promises.push(promise);
            }
            $.when.apply($, promises).done(function() {
                // Traitement supplémentaire si nécessaire
            });
        }

        function updateRecordsTable() {
            var tbody = $("#records-body");
            tbody.empty();

            for (var i = 0; i < Math.max.apply(Math, records.map(function(arr) {
                    return arr.length;
                })); i++) {
                var row = $("<tr>");
                row.append($("<td>").text("ID" + (i + 1)));
                for (var j = 0; j < fieldIds.length; j++) {
                    row.append($("<td>").text(records[j][i] || "")); // Affichage de la valeur à l'index i, ou une chaîne vide si le tableau est plus court
                }
                tbody.append(row);
            }
        }

        // Mise à jour des ID toutes les 5 secondes
        setInterval(updateRecords, 5000);
    </script>
</body>

</html>
